---
title: "EDA"
author: "Orphelia"
date: "`r format(Sys.time(), '%B %d %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, errors=FALSE, message=FALSE)
knitr::opts_knit$set(root.dir = here::here())
options(warn=-1)
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(chron))
suppressPackageStartupMessages(library(splusTimeDate))
suppressPackageStartupMessages(library(RQuantLib))
suppressPackageStartupMessages(library(kableExtra))
library(plotly)
```

```{r}
data <- read.csv("data/Relationship_bloodGrp_cleaned.csv")

#data %>% filter(Reside == 'Yes')
```

## About the participants 

### 402 participants from 41 countries residing in 33 countries
### 3 main countries of origin: 30% CIV, 19% Nigeria, 18% India, 5% Nigeria
### 3 main countries of residence: 24% USA, 20% Canada, 11% Cote d'Ivoire 

```{r}
# create network of countries of origin and countries of residence
origin <- data %>% 
  select(Origin) %>% 
  arrange(Origin) %>% 
  group_by(Origin) %>% 
  summarize(count = n()) %>% 
  arrange(desc(count)) %>% 
  mutate (percent = count/ sum(count)) %>% 
  mutate(percent = round(percent ,2))


reside <- data %>% 
  select(Reside) %>% 
  arrange(Reside) %>% 
  group_by(Reside) %>% 
  summarize(count = n()) %>% 
  arrange(desc(count)) %>% 
  mutate (percent = count/ sum(count)) %>% 
  mutate(percent = round(percent ,2)*100)
```

### Distribution of Participants' blood types vs. Distribution in main countries
### Source: https://en.wikipedia.org/wiki/Blood_type_distribution_by_country

```{r}
bt <- data %>% 
  select(BldGrp) %>% 
  arrange(BldGrp) %>% 
  group_by(BldGrp) %>%
  summarize(count = n()) %>% 
  #arrange(desc(count)) %>% 
  mutate (percent = count/ sum(count)) %>% 
  mutate(percent = round(percent ,3)*100) %>% 
  select(-count) %>% 
  mutate('Ivory Coast' = c(1,22.5,0.2,4.3,1,22.5,2,46.5),
         'Nigeria' = c(0.7,22.4,0.1,2.6,0.6,20.7,1.6,51.3),
         'India' = c(0.57,20.8,0.49,8.93,1.79,38.14,1.43,27.85),
         'Canada' = c(6,36,0.5,2.5,1.4,7.6,7,39),
         'Kenya' = c(1,25.2,0.02,4.2,0.9,21.28,1.8,45.6),
         'Ghana' = c(1.3,17.6,0.2,2.8,1.3,18.3,4.5,53.8),
         'USA' = c(6.3,35.7,0.6,3.4,1.5,8.5,6.6,37.4))

colnames(bt) <- c('Blood Type','Participants (%)', 'Ivory Coast (%)', 'Nigeria (%)', 'India (%)', 'Canada (%)', 'Kenya (%)', 'Ghana (%)', 'USA (%)')

bt <- bt  %>% 
  mutate_if(is.numeric, ~round(., 1))
```

- The distribution of blood types in our sample is well aligned with that of the selected countries. The major groups are:

    - 41% O+
    - 21% A+
    - 20% B+ 


### Genger, Relationship Status, Age

```{r}
df <- data

levels(df$Gender)[levels(df$Gender)=="Prefer not to say"] <- "Undisclosed"


df <- df %>%
     select(Gender, InRel, AgeGroup)  %>% 
    drop_na()  %>% 
    gather(variable,value) %>%
    group_by(variable, value) %>% 
    summarize(count = n()) %>% 
   mutate (percent = count/ sum(count)) %>% 
  mutate(percent = round(percent ,2)*100)


#Plots
labels<- c(
    `Gender`="Gender",
    `InRel`="In Relationship",
    `AgeGroup`="Age Group")


plot <- ggplot(df,
       aes(x = value, y = percent))+ 
        geom_bar( stat="identity")+
        facet_wrap(~variable, scales = "free_x", labeller=as_labeller(labels))+
        theme_bw()+ 
        theme(panel.grid.major=element_blank(), 
            panel.grid.minor=element_blank(),
            strip.text.x=element_text(size=11),
            axis.text.x = element_text(angle = 50, hjust = 1))+
        xlab("")+
        ylab("Percent")

ggplotly(plot)
```

- 64% of participants are between 20 and 29 years old. The second biggest age group is 30 to 39 (27%) followed by 40 to 49 (5%)
- 54% of participants are Female , 46% Male
- 64% of participants are in a relationship



```{r}
# Gender <- data %>% 
#   select(Gender) %>% 
#   arrange(Gender) %>% 
#   group_by(Gender) %>% 
#   summarize(count = n()) %>% 
#   mutate (percent = count/ sum(count)) %>% 
#   mutate(percent = round(percent ,2)*100)
# 
# relationship <- data %>% 
#   select(InRel) %>% 
#   arrange(InRel) %>% 
#   group_by(InRel) %>% 
#   summarize(count = n()) %>% 
#   mutate (percent = count/ sum(count)) %>% 
#   mutate(percent = round(percent ,2)*100)
# 
# ageGroup <- data %>% 
#   select(AgeGroup) %>% 
#   arrange(AgeGroup) %>% 
#   group_by(AgeGroup) %>% 
#   summarize(count = n()) %>% 
#   mutate (percent = count/ sum(count)) %>% 
#   mutate(percent = round(percent,2)) %>% 
#   arrange(desc(percent)*100)
```

## Network of blood group vs. partner's blood group

```{r}
#Network of blood group vs. partner's blood group
```



